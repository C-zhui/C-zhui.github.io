<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="C-zhui的小破站 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="C-zhui的小破站 Atom Feed"><title data-react-helmet="true">React状态管理 | C-zhui的小破站</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/docs/fe/state/tools"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="React状态管理 | C-zhui的小破站"><meta data-react-helmet="true" name="description" content="为什么要写这篇文章"><meta data-react-helmet="true" property="og:description" content="为什么要写这篇文章"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/docs/fe/state/tools"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/fe/state/tools" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/fe/state/tools" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.f83f813a.css">
<link rel="preload" href="/assets/js/runtime~main.81fb996a.js" as="script">
<link rel="preload" href="/assets/js/main.d3ae54c9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">C-Zhui的博客</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">知识</a><a class="navbar__item navbar__link" href="/blog">日志</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/C-zhui" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">前端知识链接</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/fe/state/tools">前端</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" tabindex="0" href="/docs/fe/state/tools">状态管理</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/fe/state/tools">React状态管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/fe/state/mobx">Mobx使用</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/fe/misc/flat">杂项</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/algo/sort">算法</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/ds/priorityQueue">数据结构</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/general/git">通用知识</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>React状态管理</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="为什么要写这篇文章">为什么要写这篇文章<a class="hash-link" href="#为什么要写这篇文章" title="Direct link to heading">​</a></h2><p>状态管理是一个老生常谈的问题，但是在 react 的框架中，这个问题似乎被「神话」了。</p><p>相信多数人在学习 react 的时候，刷完官方文档，emmmm，react 就是不断的撸组件，层层组装成一个页面，so easy 啦。但是当你真正接手祖传代码开始开发的时候，发现不是那么回事。随着组件层级的增多、状态逐渐复杂，组件状态的下传、回调，副作用的状态引用问题，进一步的重构等等，只会不断地消磨你继续写 react 的勇气，原来 react 并非无所不能，它只是提供了从状态到视图渲染的能力。你开始寻找解决方案，发现需要给项目加上状态管理，这时候你迷茫了。</p><p>react 社区状态管理方案很多，各有各的特点，可维护性、开发效率、运行效率都有一些差异。在实际的开发过程中，说哪一种方案最好，想要一个 all in one 之类的（虽然我很想要），是没有意义的，因为确实每种方案、工具都有可取之处，需要依照场景做出选择、组合。</p><p>本文章作为个人对状态管理工具的整理、总结，其中会有个人主观的一些见解和看法，本文作为一个概览，列举一些常用的方案、工具，后续或许会补充实践文章，希望对大家能有所帮助。</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="前端运行时基本框架">前端运行时基本框架<a class="hash-link" href="#前端运行时基本框架" title="Direct link to heading">​</a></h2><p><a href="https://excalidraw.com/#json=_-7wZ-atTtetIPKbKmsoh,4Ktt42PCLG0ceNGnTetIgw" target="_blank" rel="noopener noreferrer">https://excalidraw.com/#json=_-7wZ-atTtetIPKbKmsoh,4Ktt42PCLG0ceNGnTetIgw</a></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="react--状态--副作用">react &amp; 状态 &amp; 副作用<a class="hash-link" href="#react--状态--副作用" title="Direct link to heading">​</a></h2><p>react 是状态驱动的，状态决定了视图结构；状态变化，会自动通知组件渲染任务。</p><ol><li>UI = render(state)</li><li>nextState = reducer(state, action)</li></ol><p>副作用是对状态变化的监听，并触发的一段可能引起其他状态变化的逻辑，这是一种直观上的理解。
从数学的角度上，副作用就像是不动点迭代一样，副作用的意义，就是不断迭代状态，达到收敛、平衡条件。比喻起来，就是往平静的水面扔一颗石子，水面荡漾几个来回，最终归于平静。</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="生命周期">生命周期？<a class="hash-link" href="#生命周期" title="Direct link to heading">​</a></h2><p>同事问过我：你还记得几个 react 生命周期吗？
我：生命周期？几年没用过的东西了。
是的，react 实际上不需要生命周期。我其实不太想谈论这个问题。
生命周期其实专属于类组件的用法，是一种十分粗鲁的划分方式，也是不合理的。
奈何官方文档上来就给人灌输类组件生命周期 balabala 的东西，甚至把它放在所谓的 main concept 里面。
react 是状态驱动的，应该关注状态本身，而不是 react 组件的执行阶段。</p><p>面向未来、拥抱函数组件、拥抱 hook，好好理解 effect 。
群友提供：<a href="https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/" target="_blank" rel="noopener noreferrer">https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/</a></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="组件状态">组件状态<a class="hash-link" href="#组件状态" title="Direct link to heading">​</a></h2><p><strong>原生支持</strong></p><ol><li>类组件的 state </li><li>函数组件的 useState、useRef、useReducer</li></ol><p><strong>自定义 hook</strong></p><ol><li>如果想要在函数组件里面像类组件一样操作state，使用 react-use(或者 hooks)中的useSetState</li><li>如果想要避免 callback 里面获取过期的 state，使用 react-use 中的 useGetSet / useGetSetState</li><li>... ... 无法穷举，总之 react-use / ahooks/ @byted/hooks 都是不错的，有很多好用的工具，可以整体过一遍</li></ol><p>另外一些状态管理库支持 localStore，可以将状态和操作逻辑内聚
比如 reduck 的 useLocalModel、mobx 的 useLocalObservable</p><p><strong>表单状态</strong>
表单状态其实就是带有 动态生成规则和校验规则的状态，取决于具体的业务逻辑，要多复杂有多复杂。自行体会。
方案：antd form、formik、formily</p><p><strong>其他</strong></p><ol><li>结合 @vue/reactivity 的 reactivue 👍🏻</li><li>GUI debug 控件 <a href="https://github.com/pmndrs/leva" target="_blank" rel="noopener noreferrer">https://github.com/pmndrs/leva</a> </li></ol><p>编不下去了，组件状态整体还是挺简单的，选择也很多...</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="信道--管道流">信道 / 管道流<a class="hash-link" href="#信道--管道流" title="Direct link to heading">​</a></h2><p>并不能直接作为状态管理，但是可用于信息传递、加工，了解这两个应该够用</p><ol><li>eventemitter3：Nodejs 的 eventemitter 在浏览器的实现</li><li>rxjs：强大的事件流处理工具，FRP ，当你需要处理、转换、组合事件流的时候，rxjs 一定是很好的助力</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="全局状态">全局状态<a class="hash-link" href="#全局状态" title="Direct link to heading">​</a></h2><p><strong>通用</strong></p><ol><li>redux ：唯一数据源，基于纯函数（reducer）生成新状态 nextState = reducer(state, action) ，向 store 发送 action 触发状态更新。</li><li>副作用全靠中间件支持 (redux-saga、redux-thunk，redux-observable)</li><li>模板写到怀疑人生 (redux toolkit、dva 等可以简化)</li><li>结合 react-redux、reselect 桥接 react </li><li>mobx ：基于属性访问劫持（类似 vue ）的响应式方案可以很轻松地做精细的性能优化，但本身过于自由，使用 mobx-react 桥接 react</li><li>unstated-next：基于原生 hook + context</li><li>recoil：与 redux 的中心化状态不同，它是原子化的共享状态方案</li></ol><p><strong>服务端状态管理</strong>
fetch、cache</p><ol><li>apollo：GraphQL 客户端，严格定义业务数据模型，按需获取</li><li>react-query：含请求、缓存、重试，实际上可以完全不限于请求，它是一个异步状态管理器 </li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="url状态">URL状态<a class="hash-link" href="#url状态" title="Direct link to heading">​</a></h2><p>react-router 实际上也是一种特殊的全局状态管理。</p><ol><li>路径参数 /post/:id ，用于定位、选择具体的页面、组件</li><li>SearchString 参数 ?a=1&amp;b=hello，用于传递更多参数，通常用于页面上表单的初始化，v6 提供了操作 SearchString 的 hook，低版本需要自己封装</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="状态机">状态机<a class="hash-link" href="#状态机" title="Direct link to heading">​</a></h2><p>状态机其实都是 nextState = map(state, event)</p><ol><li>redux：redux 实际上就是个状态机，严格定义了状态树结构，但状态变化没有严格定义，所以对于复杂的业务逻辑，很难使用 redux 描述清楚</li><li>xstate：有限状态机，xstate 将状态分成了状态机状态和附加的 context data。给状态迁移添加了条件，以 JSON 描述状态之间跳转逻辑，可以结合官方提供的可视化工具查看状态图，有助于理清状态机的变化逻辑</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="总结">总结<a class="hash-link" href="#总结" title="Direct link to heading">​</a></h2><p>本文根据我个人的理解对 react 状态管理做了一些分类，并列举了其中一些具体的常用的状态管理工具，简述了各种工具的特点，就不提供具体的示例了，各位同学可以根据业务场景选择合适的。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">前端知识链接</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/fe/state/mobx"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mobx使用</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#为什么要写这篇文章" class="table-of-contents__link toc-highlight">为什么要写这篇文章</a></li><li><a href="#前端运行时基本框架" class="table-of-contents__link toc-highlight">前端运行时基本框架</a></li><li><a href="#react--状态--副作用" class="table-of-contents__link toc-highlight">react &amp; 状态 &amp; 副作用</a></li><li><a href="#生命周期" class="table-of-contents__link toc-highlight">生命周期？</a></li><li><a href="#组件状态" class="table-of-contents__link toc-highlight">组件状态</a></li><li><a href="#信道--管道流" class="table-of-contents__link toc-highlight">信道 / 管道流</a></li><li><a href="#全局状态" class="table-of-contents__link toc-highlight">全局状态</a></li><li><a href="#url状态" class="table-of-contents__link toc-highlight">URL状态</a></li><li><a href="#状态机" class="table-of-contents__link toc-highlight">状态机</a></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/assets/js/runtime~main.81fb996a.js"></script>
<script src="/assets/js/main.d3ae54c9.js"></script>
</body>
</html>